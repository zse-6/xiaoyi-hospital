<!--pages/process/process.wxml-->
<view class="process-page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <text class="page-title">å°±è¯Šæµç¨‹ç®¡ç†</text>
      <text class="current-time">å½“å‰æ—¶é—´ {{currentTime}}</text>
    </view>
    <text class="page-subtitle">ä¸€ç«™å¼å°±è¯Šå…¨æµç¨‹é™ªä¼´</text>
  </view>

  <!-- å½“å‰æµç¨‹å¡ç‰‡ -->
  <view class="current-process-card">
    <view class="process-header">
      <view class="process-info">
        <text class="process-title">{{currentProcess.title}}</text>
        <text class="process-time">é¢„è®¡è€—æ—¶ {{currentProcess.estimatedTime}}</text>
      </view>
      <view class="process-status">
        <text class="status-badge {{isInProcess ? 'active' : 'completed'}}">
          {{isInProcess ? 'è¿›è¡Œä¸­' : 'å·²å®Œæˆ'}}
        </text>
      </view>
    </view>
    
    <text class="process-description">{{currentProcess.description}}</text>
    
    <view class="process-departments">
      <text class="dept-label">æ¶‰åŠç§‘å®¤ï¼š</text>
      <view class="dept-tags">
        <block wx:for="{{currentProcess.departments}}" wx:key="*this">
          <view class="dept-tag">
            <text>{{item}}</text>
          </view>
        </block>
      </view>
    </view>
    
    <view class="process-actions" wx:if="{{isInProcess}}">
      <view class="appointment-time">
        <text class="time-label">é¢„çº¦æ—¶é—´ï¼š</text>
        <text class="time-value">{{appointmentTime}}</text>
      </view>
      <view class="action-buttons">
        <button class="action-btn" bindtap="setAppointmentTime">â° ä¿®æ”¹æ—¶é—´</button>
        <button class="action-btn primary" bindtap="shareProcess">ğŸ“¤ åˆ†äº«æµç¨‹</button>
      </view>
    </view>
  </view>

  <!-- æµç¨‹æ­¥éª¤ -->
  <view class="process-steps-section">
    <view class="section-header">
      <text class="section-title">å°±è¯Šæ­¥éª¤</text>
      <text class="section-subtitle">ç‚¹å‡»æ­¥éª¤æŸ¥çœ‹è¯¦æƒ…</text>
    </view>
    
    <view class="timeline">
      <block wx:for="{{processSteps}}" wx:key="id">
        <view class="timeline-item">
          <!-- æ—¶é—´çº¿è¿æ¥çº¿ -->
          <view class="timeline-connector" wx:if="{{index > 0}}"></view>
          
          <!-- æ­¥éª¤èŠ‚ç‚¹ -->
          <view 
            class="step-node {{item.status}}" 
            bindtap="viewStepDetail"
            data-id="{{item.id}}"
            style="background-color: {{item.color}}"
          >
            <text class="step-icon">{{item.icon}}</text>
          </view>
          
          <!-- æ­¥éª¤å†…å®¹ -->
          <view 
            class="step-content" 
            bindtap="viewStepDetail"
            data-id="{{item.id}}"
          >
            <view class="step-header">
              <text class="step-title">{{item.title}}</text>
              <view class="step-status">
                <text class="status-text {{item.status}}">
                  {{item.status === 'completed' ? 'å·²å®Œæˆ' : item.status === 'current' ? 'è¿›è¡Œä¸­' : 'å¾…å¼€å§‹'}}
                </text>
              </view>
            </view>
            
            <text class="step-time">{{item.time}}</text>
            
            <view class="step-action" wx:if="{{item.status === 'current' && isInProcess}}">
              <button 
                class="complete-btn" 
                bindtap="toggleStepStatus"
                data-id="{{item.id}}"
                catchtap
              >
                âœ… æ ‡è®°å®Œæˆ
              </button>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- å¾…åŠäº‹é¡¹ -->
  <view class="todos-section">
    <view class="section-header">
      <text class="section-title">å¾…åŠäº‹é¡¹</text>
      <view class="add-todo-btn" bindtap="addTodo">
        <text>+ æ·»åŠ </text>
      </view>
    </view>
    
    <view class="todos-list">
      <block wx:for="{{todos}}" wx:key="id">
        <view 
          class="todo-item {{item.completed ? 'completed' : ''}}" 
          bindtap="toggleTodo"
          data-id="{{item.id}}"
        >
          <view class="todo-checkbox">
            <text class="checkbox-icon">{{item.completed ? 'âœ“' : ''}}</text>
          </view>
          <text class="todo-text">{{item.title}}</text>
        </view>
      </block>
    </view>
  </view>

  <!-- æé†’è®¾ç½® -->
  <view class="reminders-section">
    <view class="section-header">
      <text class="section-title">æ™ºèƒ½æé†’</text>
      <text class="section-subtitle">ä¸é”™è¿‡ä»»ä½•å…³é”®èŠ‚ç‚¹</text>
    </view>
    
    <view class="reminders-list">
      <block wx:for="{{reminders}}" wx:key="id">
        <view class="reminder-item">
          <view class="reminder-info">
            <text class="reminder-name">{{item.name}}</text>
            <text class="reminder-status">{{item.enabled ? 'å·²å¼€å¯' : 'å·²å…³é—­'}}</text>
          </view>
          <switch 
            checked="{{item.enabled}}" 
            bindchange="toggleReminder"
            data-id="{{item.id}}"
            color="#2a8ce5"
          />
        </view>
      </block>
    </view>
  </view>

  <!-- å…¶ä»–æµç¨‹é€‰é¡¹ -->
  <view class="other-processes-section">
    <view class="section-header">
      <text class="section-title">å…¶ä»–å°±è¯Šæµç¨‹</text>
      <text class="section-subtitle">æ ¹æ®æƒ…å†µé€‰æ‹©ä¸åŒæµç¨‹</text>
    </view>
    
    <view class="process-cards">
      <block wx:for="{{otherProcesses}}" wx:key="id">
        <view 
          class="process-card" 
          bindtap="selectProcess"
          data-id="{{item.id}}"
        >
          <view class="process-card-header">
            <text class="card-title">{{item.title}}</text>
            <view class="card-tag {{item.urgent ? 'urgent' : item.inpatient ? 'inpatient' : 'checkup'}}">
              {{item.urgent ? 'ç´§æ€¥' : item.inpatient ? 'ä½é™¢' : 'ä½“æ£€'}}
            </view>
          </view>
          
          <text class="card-time">â±ï¸ {{item.estimatedTime}}</text>
          <text class="card-desc">{{item.description}}</text>
          
          <view class="card-departments">
            <block wx:for="{{item.departments}}" wx:key="*this">
              <text class="card-dept">{{item}}</text>
            </block>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="action-buttons-section">
    <button 
      class="start-btn" 
      bindtap="startProcess"
      wx:if="{{!isInProcess}}"
    >
      <text class="btn-icon">ğŸš€</text>
      <text class="btn-text">å¼€å§‹å°±è¯Šæµç¨‹</text>
    </button>
    
    <button 
      class="complete-btn" 
      bindtap="completeProcess"
      wx:if="{{isInProcess}}"
    >
      <text class="btn-icon">âœ…</text>
      <text class="btn-text">å®Œæˆå°±è¯Šæµç¨‹</text>
    </button>
    
    <button class="stats-btn" bindtap="viewStatistics">
      <text class="btn-icon">ğŸ“Š</text>
      <text class="btn-text">æŸ¥çœ‹ç»Ÿè®¡</text>
    </button>
  </view>

  <!-- æ­¥éª¤è¯¦æƒ…å¼¹çª— -->
  <view class="step-detail-modal" wx:if="{{showStepDetail}}">
    <view class="modal-overlay" bindtap="closeStepDetail"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{currentStepDetail.title}}</text>
        <view class="modal-close" bindtap="closeStepDetail">
          <text>Ã—</text>
        </view>
      </view>
      
      <view class="modal-body">
        <view class="step-info">
          <view class="step-icon-large" style="background-color: {{currentStepDetail.color}}">
            <text>{{currentStepDetail.icon}}</text>
          </view>
          <text class="step-status-large">{{currentStepDetail.status === 'completed' ? 'å·²å®Œæˆ' : currentStepDetail.status === 'current' ? 'è¿›è¡Œä¸­' : 'å¾…å¼€å§‹'}}</text>
          <text class="step-time-large">{{currentStepDetail.time}}</text>
        </view>
        
        <view class="detail-section">
          <text class="section-title">è¯¦ç»†å†…å®¹</text>
          <view class="detail-list">
            <block wx:for="{{currentStepDetail.details}}" wx:key="*this">
              <view class="detail-item">
                <text class="bullet">â€¢</text>
                <text>{{item}}</text>
              </view>
            </block>
          </view>
        </view>
        
        <view class="tips-section">
          <text class="section-title">æ¸©é¦¨æç¤º</text>
          <view class="tips-list">
            <block wx:for="{{currentStepDetail.tips}}" wx:key="*this">
              <view class="tip-item">
                <text class="tip-icon">ğŸ’¡</text>
                <text>{{item}}</text>
              </view>
            </block>
          </view>
        </view>
        
        <button 
          class="modal-action-btn" 
          bindtap="toggleStepStatus"
          data-id="{{currentStepDetail.id}}"
          wx:if="{{currentStepDetail.status === 'current' && isInProcess}}"
        >
          <text>âœ… æ ‡è®°ä¸ºå·²å®Œæˆ</text>
        </button>
      </view>
    </view>
  </view>
</view>